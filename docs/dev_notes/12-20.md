# 2025-12-20 é–‹ç™¼ç­†è¨˜ (W8 Day 6)

**æ—¥æœŸï¼š** 2025/12/20ï¼ˆæ˜ŸæœŸäº”ï¼‰  
**ç›®æ¨™ï¼š** YOLO-World + DA3 èåˆå¯¦ä½œå•Ÿå‹•  
**é—œéµé‡Œç¨‹ç¢‘ï¼š** 2026/1/7 ç¬¬ä¸€éšæ®µç™¼è¡¨ï¼ˆå‰©é¤˜ 18 å¤©ï¼‰

---

## ğŸ‰ ä»Šæ—¥æˆæœç¸½è¦½

> [!TIP]
> **Phase 1 + Phase 2 å®Œæˆï¼** åŸè¨ˆç•« 2 å¤©çš„å·¥ä½œåœ¨ 1 å°æ™‚å…§å®Œæˆ

| Phase | ç›®æ¨™ | ç‹€æ…‹ | è€—æ™‚ |
|-------|------|------|------|
| Phase 1 | YOLO Server éƒ¨ç½² | âœ… å®Œæˆ | ~30 åˆ†é˜ |
| Phase 2 | `/find_object` API | âœ… å®Œæˆ | ~30 åˆ†é˜ |
| Phase 3 | MCP Tools | â³ å¾…é€²è¡Œ | - |

---

## ğŸ“‹ ä»»å‹™å®Œæˆæ¸…å–®

### Phase 1ï¼šYOLO-World ç’°å¢ƒéƒ¨ç½² âœ…

| ç·¨è™Ÿ | ä»»å‹™ | é©—æ”¶æ¨™æº– | ç‹€æ…‹ |
|------|------|---------|------|
| 1.1 | SSH é€£ç·š GPU Server | å·²é€£ç·š | âœ… |
| 1.2 | å®‰è£ YOLO-World ä¾è³´ | `uv pip install ultralytics supervision` | âœ… |
| 1.3 | YOLO æ¨¡å‹ | `yolov8l-worldv2.pt` (90MB, Largeç‰ˆ) | âœ… |
| 1.4 | YOLO Server | Port 8000 é‹è¡Œä¸­ | âœ… |
| 1.5 | æ¨è«–æ¸¬è©¦ | **42ms** (ç›®æ¨™ 200msï¼Œè¶…æ¨™ 5 å€ï¼) | âœ… |

### Phase 2ï¼šYOLO + DA3 èåˆ `/find_object` API âœ…

| ç·¨è™Ÿ | ä»»å‹™ | ç‹€æ…‹ |
|------|------|------|
| 2.1 | é©—è­‰ `depth-v2` conda ç’°å¢ƒ | âœ… |
| 2.2 | å®‰è£ ultralytics åˆ° depth-v2 | âœ… |
| 2.3 | å»ºç«‹ `perception_server_v2.py` | âœ… |
| 2.4 | æ¸¬è©¦ `/find_object` API | âœ… |
| 2.5 | æ¸¬è©¦ `/find_object/summary` API | âœ… |

---

## ğŸš€ é‹è¡Œä¸­çš„æœå‹™

| æœå‹™ | Port | ç”¨é€” | ç’°å¢ƒ |
|------|------|------|------|
| YOLO Server | **8000** | ç´”ç‰©ä»¶åµæ¸¬ | `~/Yoloworld/.venv` (uv) |
| Perception V2 | **8001** | YOLO + DA3 èåˆ | `depth-v2` (conda) |

---

## ğŸ“Š API æ¸¬è©¦çµæœ

### `/find_object` å®Œæ•´å›æ‡‰

```json
{
  "found": true,
  "target": "bottle",
  "results": [{
    "label": "bottle",
    "confidence": 0.892,
    "distance_m": 0.49,
    "direction": "æ­£å‰æ–¹",
    "center": [318, 584],
    "bbox": [215, 263, 207, 641],
    "cmd_vel": {
      "linear_x": 0.1,
      "angular_z": 0.0
    }
  }],
  "timing_ms": {
    "yolo": 41.6,
    "depth": 289.3,
    "total": 380.2
  }
}
```

### `/find_object/summary` ç°¡åŒ–å›æ‡‰ï¼ˆçµ¦ LLMï¼‰

```json
{
  "found": true,
  "label": "bottle",
  "distance_m": 0.49,
  "direction": "æ­£å‰æ–¹",
  "cmd_vel": {"linear_x": 0.1, "angular_z": 0.0},
  "message": "ç™¼ç¾ bottle åœ¨æ­£å‰æ–¹ï¼Œè·é›¢ 0.5 å…¬å°º"
}
```

### å¤šåœ–ç‰‡æ¸¬è©¦çµæœ

| æ¸¬è©¦ | ç›®æ¨™ | è·é›¢ | æ–¹å‘ | cmd_vel |
|------|------|------|------|---------|
| test_person.jpg | person | **1.01m** | æ­£å‰æ–¹ | `linear: 0.2, angular: 0` |
| test_chair.jpg | chair | **0.75m** | æ­£å‰æ–¹ | `linear: 0.1, angular: 0` |
| test_cup.jpg | cup | **0.39m** | å·¦å´ | `linear: 0.1, angular: 0.3` |
| test_image.jpg | bottle | **0.49m** | æ­£å‰æ–¹ | `linear: 0.1, angular: 0` |

---

## âš¡ æ•ˆèƒ½æŒ‡æ¨™

### æ¨è«–æ™‚é–“

| æ¨¡å‹ | é¦–æ¬¡ | Warm-up å¾Œ |
|------|------|-----------|
| YOLO-World | 523ms | **42ms** |
| DA3 Depth | 333ms | **289ms** |
| **ç¸½è¨ˆ** | 923ms | **380ms** âš¡ |

### è³‡æºä½¿ç”¨

| è³‡æº | æ•¸å€¼ |
|------|------|
| VRAM | 1.93 GB |
| GPU | Quadro RTX 8000 (48GB) Ã— 5 |
| Python | 3.12.3 (uv) / 3.10.19 (conda) |

---

## ğŸ—ï¸ æŠ€è¡“æ¶æ§‹

### æ„ŸçŸ¥èåˆæµç¨‹

```
ä½¿ç”¨è€…ï¼šã€Œå¹«æˆ‘æ‰¾æ°´ç“¶ã€
      â†“
LLM å‘¼å« find_object("æ°´ç“¶") MCP Tool
      â†“
HTTP POST â†’ GPU Server :8001/find_object
      â”œâ”€â”€ YOLO-Worldï¼šåµæ¸¬ç‰©é«” â†’ bbox, center (42ms)
      â””â”€â”€ DA3 Metricï¼šæ·±åº¦ä¼°è¨ˆ â†’ distance (289ms)
            â†“ èåˆè¼¸å‡º JSON
{ "label": "æ°´ç“¶", "distance_m": 0.5, "direction": "æ­£å‰æ–¹", "cmd_vel": {...} }
      â†“
Go2 æ©Ÿå™¨ç‹—åŸ·è¡Œç§»å‹•
```

### å°èˆªæŒ‡ä»¤é‚è¼¯

| ç‰©ä»¶ä½ç½® | cx ç¯„åœ | angular_z | èªªæ˜ |
|----------|---------|-----------|------|
| å·¦å´ | < 213 | +0.3 | å‘å·¦è½‰ |
| æ­£å‰æ–¹ | 213-427 | 0.0 | ç›´è¡Œ |
| å³å´ | > 427 | -0.3 | å‘å³è½‰ |

| è·é›¢ | linear_x | èªªæ˜ |
|------|----------|------|
| < 0.3m | 0.0 | åœæ­¢ |
| 0.3-1.0m | 0.1 | æ…¢é€Ÿ |
| > 1.0m | 0.2 | æ­£å¸¸ |

---

## ğŸ“ æª”æ¡ˆçµæ§‹

### GPU Server

```
~/Yoloworld/
â”œâ”€â”€ .venv/                    # uv è™›æ“¬ç’°å¢ƒ
â”œâ”€â”€ YoloworldGPU.py           # YOLO Server (Port 8000)
â”œâ”€â”€ perception_server_v2.py   # èåˆ Server (Port 8001) â­
â”œâ”€â”€ yolov8l-worldv2.pt        # YOLO æ¨¡å‹ (90MB)
â”œâ”€â”€ test_image.jpg            # æ¸¬è©¦åœ–ç‰‡ - æ°´ç“¶
â”œâ”€â”€ test_person.jpg           # æ¸¬è©¦åœ–ç‰‡ - äºº
â”œâ”€â”€ test_chair.jpg            # æ¸¬è©¦åœ–ç‰‡ - æ¤…å­
â”œâ”€â”€ test_cup.jpg              # æ¸¬è©¦åœ–ç‰‡ - æ¯å­
â”œâ”€â”€ detected_result.jpg       # åµæ¸¬çµæœåœ–
â””â”€â”€ docs/
    â””â”€â”€ 2025-12-20.md         # æœ¬æ–‡ä»¶

~/Depth_Anything_V2/Depth-Anything-V2/
â”œâ”€â”€ checkpoints/
â”‚   â””â”€â”€ depth_anything_v2_metric_hypersim_vitl.pth
â”œâ”€â”€ metric_depth/
â”‚   â””â”€â”€ depth_anything_v2/
â”œâ”€â”€ perception_server/
â”‚   â”œâ”€â”€ perception_server.py       # åŸç‰ˆ DA3 Server
â”‚   â”œâ”€â”€ perception_server_v2.py    # èåˆç‰ˆ (å‰¯æœ¬)
â”‚   â”œâ”€â”€ perception_server_backup.py
â”‚   â””â”€â”€ yolov8l-worldv2.pt         # YOLO æ¨¡å‹ (å‰¯æœ¬)
```

---

## ğŸ› ï¸ å¦‚ä½•å•Ÿå‹•æœå‹™

### å•Ÿå‹• YOLO Server (Port 8000)

```bash
cd ~/Yoloworld
source .venv/bin/activate
uvicorn YoloworldGPU:app --host 0.0.0.0 --port 8000
```

### å•Ÿå‹• Perception Server V2 (Port 8001) â­

```bash
source ~/miniconda3/bin/activate depth-v2
cd ~/Yoloworld  # æˆ– ~/Depth_Anything_V2/.../perception_server
uvicorn perception_server_v2:app --host 0.0.0.0 --port 8001
```

### API æ¸¬è©¦æŒ‡ä»¤

```bash
# æ‰¾æ°´ç“¶
curl -X POST "http://localhost:8001/find_object/summary" \
  -F "image=@test_image.jpg" \
  -F "target=bottle"

# æ‰¾äºº
curl -X POST "http://localhost:8001/find_object" \
  -F "image=@test_person.jpg" \
  -F "target=person"
```

---

## ğŸ“ é–‹ç™¼æ—¥èªŒ

### 20:50 - ç’°å¢ƒæª¢æŸ¥

- ç¢ºèªç¾æœ‰ `YoloworldGPU.py` å’Œ `yolov8l-worldv2.pt`
- ç™¼ç¾ GPU: 5 Ã— RTX 8000 (48GB)
- Python 3.12.3 ä½†ç¼ºå°‘ PyTorch

### 21:02 - uv ç’°å¢ƒå»ºç«‹

- å®‰è£ uv (Rust-based Python package manager)
- å»ºç«‹ `.venv` è™›æ“¬ç’°å¢ƒ
- å®‰è£ PyTorch 2.9.1+cu128ã€ultralytics 8.3.240

### 21:13 - Phase 1 å®Œæˆ

- YOLO Server å•Ÿå‹•æ–¼ Port 8000
- æ¸¬è©¦ `/detect` API æˆåŠŸ
- æ¨è«–æ™‚é–“ 80ms â†’ warm-up å¾Œ 42ms

### 21:26 - Phase 2 é–‹å§‹

- ç¢ºèª DA3 ä½ç½®ï¼š`~/Depth_Anything_V2/Depth-Anything-V2/`
- ç¢ºèª conda ç’°å¢ƒï¼š`depth-v2`
- ç¢ºèªæ¨¡å‹ï¼š`depth_anything_v2_metric_hypersim_vitl.pth`
- ç™¼ç¾å·²æœ‰ `perception_server.py`ï¼

### 21:31 - èåˆå¯¦ä½œ

- åœ¨ depth-v2 ç’°å¢ƒå®‰è£ ultralytics
- å»ºç«‹ `perception_server_v2.py` æ•´åˆ YOLO + DA3
- æ–°å¢ `/find_object` å’Œ `/find_object/summary` ç«¯é»

### 21:35 - Phase 2 å®Œæˆ

- Perception Server V2 å•Ÿå‹•æ–¼ Port 8001
- æ‰€æœ‰æ¸¬è©¦é€šéï¼
- èåˆæ¨è«–æ™‚é–“ï¼š380msï¼ˆYOLO 42ms + DA3 289msï¼‰

---

## ğŸ¯ ä¸‹ä¸€æ­¥ï¼šPhase 3

### MCP Tools é–‹ç™¼

1. åœ¨ `ros-mcp-server/server.py` æ–°å¢ `find_object` Tool
2. Tool å‘¼å« `http://GPU_SERVER:8001/find_object/summary`
3. å›å‚³çµæœçµ¦ LLM åšæ±ºç­–

### é è¨ˆ API

```python
@mcp.tool()
async def find_object(target: str) -> str:
    """
    ä½¿ç”¨ YOLO + DA3 æœå°‹ç‰©ä»¶
    å›å‚³ï¼šç‰©ä»¶ä½ç½®ã€è·é›¢ã€æ–¹å‘ã€å°èˆªæŒ‡ä»¤
    """
    # å¾ Go2 æ”åƒé ­å–å¾—åœ–ç‰‡
    # POST åˆ° GPU Server /find_object/summary
    # å›å‚³çµæœ
```

---

## ğŸ”— ç›¸é—œè³‡æº

- [Perception Server V2](file:///home/roy422/Yoloworld/perception_server_v2.py)
- [YOLO Server](file:///home/roy422/Yoloworld/YoloworldGPU.py)
- [DA3 ç›®éŒ„](file:///home/roy422/Depth_Anything_V2/Depth-Anything-V2/)

---

**æœ€å¾Œæ›´æ–°ï¼š** 2025-12-20 21:39
